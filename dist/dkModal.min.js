!function(){"use strict";if(!$)throw new Error("dkModal depends on jquery");if(!angular)throw new Error("dkModal depends on angular");var e=angular.module("dkModal",["ngAnimate"]);e.provider("$dkModal",function(){var e=767,t=27,o=2,n="96%",i={},r=-1!=window.navigator.userAgent.indexOf("Mobi"),a={selector:void 0,template:void 0,key:!0,click:!0,offsetTop:void 0,offsetLeft:void 0,target:void 0,targetVert:"middle",targetSide:"right",targetOffset:20,width:void 0,height:void 0,backdropColor:void 0,cancelEventName:"modalCancel",okEventName:"modalOk"};return i.setDefaults=function(e){angular.extend(a,e)},i.$get=["$http","$templateCache","$compile","$animate","$rootScope","$timeout",function(i,d,s,l,c,f){return function(h){function p(e){return c.$apply(function(){H.hide("ok")}),!1}function g(e){return c.$apply(function(){H.hide("cancel")}),!1}function w(e){return e.which==t&&c.$apply(function(){H.hide("cancel")}),!1}function u(){return c.$apply(function(){H.hide("cancel")}),!1}function m(){var t,i,a,d;if(a=r&&window.innerWidth<=e,d=k.find("input, select, textarea").length>0,k.find(".exit-ok").click(p),k.find(".exit-cancel").click(g),k.addClass("dk-modal"),k.attr("tabindex","-1"),M.key&&k.on("keyup",w),M.width){var s=-1!=M.width.indexOf("%")?window.innerWidth*parseInt(M.width)/100:parseInt(M.width);s>window.innerWidth?(s=window.innerWidth+"px",console.log("constrain width to:",window.innerWidth,"of: ",window.innerWidth)):s=M.width,k.css("width",s)}else k.css("width","");var c=window.innerWidth*(o/100);if(M.height){var f=-1!=M.height.indexOf("%")?window.innerHeight*parseInt(M.height)/100:parseInt(M.height);a&&f+c>window.innerHeight?(f=window.innerHeight-c+"px",console.log("constrain setHeight to:",f,"of",window.innerHeight)):f>window.innerHeight?(f=window.innerHeight+"px",console.log("constrain setHeight to:",f,"of",window.innerHeight)):f=M.height,k.css("height",f)}else k.css("height","");k.css("left","-9999px"),k.show(),y||$(document.body).prepend(k);var h=k.outerWidth(),m=k.outerHeight();if(k.hide(),k.css("left",""),m+(a?c:0)>window.innerHeight&&(m=window.innerHeight-(a?c:0),k.css("height",m+"px"),console.log("constrain height to:",m,"innerHeight",window.innerHeight)),k.css("top",""),k.css("left",""),k.css("transform",""),a&&d)k.css("transform","translate(0,0)"),k.css("top",c+"px"),k.css("left",o+"%"),k.css("width",n);else if(M.offsetTop&&M.offsetLeft){k.css("transform","translate(0,0)");var x=-1!=M.offsetTop.indexOf("%")?window.innerHeight*parseInt(M.offsetTop)/100:parseInt(M.offsetTop),H=-1!=M.offsetLeft.indexOf("%")?window.innerWidth*parseInt(M.offsetLeft)/100:parseInt(M.offsetLeft);x+m<window.innerHeight?i=M.offsetTop:(i=window.innerHeight-m+"px",console.log("adj top to:",i)),H+h<window.innerWidth?t=M.offsetLeft:(t=window.innerWidth-h+"px",console.log("adj left to:",t)),k.css("top",i),k.css("left",t)}else if(M.target){k.css("transform","translate(0,0)");var W=M.targetSide||"right",E=$(M.target);if(!E.length)throw new Error("Failed to locate target: "+M.target);var b=E.offset(),T=E.outerWidth(),C=E.outerHeight();"right"==W?b.left+T+M.targetOffset+h<window.innerWidth?t=b.left+T+M.targetOffset:(t=window.innerWidth-h,console.log("adj left to:",t)):"left"==W&&(b.left-M.targetOffset-h>0?t=b.left-M.targetOffset-h:(t=0,console.log("adj left to:",t))),"top"==M.targetVert?i=b.top:"middle"==M.targetVert?i=b.top-m/2+C/2:"bottom"==M.targetVert&&(i=b.top-m+C),0>i&&(i=0,console.log("adj top to:",i)),i+m>window.innerHeight&&(i=window.innerHeight-m,console.log("adj top to:",i)),k.css("top",i+"px"),k.css("left",t+"px")}v=$('<div tabindex="-1" class="dk-modal-backdrop"></div>'),M.backdropColor&&v.css("background-color",M.backdropColor),M.click&&v.click(u),M.key&&v.keyup(w),$("body").prepend(v),v.show(),l.addClass(v,"open"),k.show(),k.focus(),l.addClass(k,"open").then(function(){k.trigger("show")})}var k,v,x,H={},y=!1,M=angular.extend({},a,h);return H.hide=function(e){y&&(k.find(".exit-ok").off("click",p),k.find(".exit-cancel").off("click",g),k.off("keyup",w)),l.removeClass(v,"open").then(function(){v.remove()}),l.removeClass(k,"open").then(function(){var t="ok"==e?M.okEventName:M.cancelEventName;k.trigger(t),c.$broadcast(t),y?k.hide():k.remove()})},H.init=function(){function e(e,t){this["scope_"+t]=e}if(!M.selector&&!M.template)throw new Error("Must set either dk-modal to selector or data-template to template");if(M.template){if(!M.scope)throw new Error("scope is required with template option");M.scope.$regScope=e;var t;if((t=d.get(M.template))?k=s(t)(M.scope):i.get(M.template).then(function(e){d.put(e.data),k=s(e.data)(M.scope),safeDigest(M.scope)},function(e){throw new Error(e.message)}),!k||0===k.length)throw new Error("Failed to create modal from template: "+M.template)}else if(M.selector&&(y=!0,k=$(M.selector),0===k.length))throw new Error("Failed to find modal from selector: "+M.selector);return angular.extend(M,k.data(),h),x={modal:k,scope:M.scope&&M.scope.$modalChild||M.scope}},H.show=function(e){return x||H.init(),M.template?f(function(){m(),e&&e(x)}):(m(),e&&e(x)),x},H}}],i}),e.directive("dkModalTrigger",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$dkModal",function(e,t,o,n){t.click(function(){var i=t.data();if(i.template?i.scope=e:o.dkModalTrigger&&/.html$/i.test(o.dkModalTrigger)?(i.template=o.dkModalTrigger,i.scope=e):!i.selector&&o.dkModalTrigger&&(i.selector=o.dkModalTrigger),!i.template&&!i.selector)throw new Error("dkModal: Must supply either a template or selector");"this"==i.target&&(i.target=t),e.$apply(function(){n(i).show()})})}]}})}();