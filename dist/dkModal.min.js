!function(){"use strict";function e(e){return $.each(e,function(t,o){"string"==typeof e[t]&&(e[t]=e[t].trim())}),["offsetTop","offSetLeft","width","height"].forEach(function(t,o){"number"==typeof e[t]&&(e[t]=e[t]+"px")}),"string"==typeof e.targetOffset&&-1!=e.targetOffset.indexOf("px")&&(e.targetOffset=parseFloat(e.targetOffset)),e}if(!$)throw new Error("dkModal depends on jquery");if(!angular)throw new Error("dkModal depends on angular");var t=angular.module("dkModal",["ngAnimate"]);t.provider("$dkModal",function(){var t=767,o=27,n=2,i="96%",r={},a=-1!=window.navigator.userAgent.indexOf("Mobi"),d={selector:void 0,template:void 0,key:!0,click:!0,offsetTop:void 0,offsetLeft:void 0,target:void 0,targetVert:"middle",targetSide:"right",targetOffset:20,width:void 0,height:void 0,backdropColor:void 0,cancelEventName:"modalCancel",okEventName:"modalOk"};return r.setDefaults=function(t){angular.extend(d,e(t))},r.$get=["$http","$templateCache","$compile","$animate","$rootScope","$timeout",function(r,s,f,c,l,p){return function(h){function g(e){return l.$apply(function(){O.hide("ok")}),!1}function w(e){return l.$apply(function(){O.hide("cancel")}),!1}function u(e){return e.which==o&&l.$apply(function(){O.hide("cancel")}),!1}function m(){return l.$apply(function(){O.hide("cancel")}),!1}function k(){var e,o,r,d;if(r=a&&window.innerWidth<=t,d=v.find("input, select, textarea").length>0,v.find(".exit-ok").click(g),v.find(".exit-cancel").click(w),v.addClass("dk-modal"),v.attr("tabindex","-1"),E.key&&v.on("keyup",u),E.width){var s=-1!=E.width.indexOf("%")?window.innerWidth*parseInt(E.width)/100:parseInt(E.width);s=s>window.innerWidth?window.innerWidth+"px":E.width,v.css("width",s)}else v.css("width","");var f=window.innerWidth*(n/100);if(E.height){var l=-1!=E.height.indexOf("%")?window.innerHeight*parseInt(E.height)/100:parseInt(E.height);l=r&&l+f>window.innerHeight?window.innerHeight-f+"px":l>window.innerHeight?window.innerHeight+"px":E.height,v.css("height",l)}else v.css("height","");v.css("left","-9999px"),v.show(),M||$(document.body).prepend(v);var p=v.outerWidth(),h=v.outerHeight();if(v.hide(),v.css("left",""),h+(r?f:0)>window.innerHeight&&(h=window.innerHeight-(r?f:0),v.css("height",h+"px")),v.css("top",""),v.css("left",""),v.css("transform",""),r&&d)v.css("transform","translate(0,0)"),v.css("top",f+"px"),v.css("left",n+"%"),v.css("width",i);else if(E.offsetTop&&E.offsetLeft){v.css("transform","translate(0,0)");var k=-1!=E.offsetTop.indexOf("%")?window.innerHeight*parseInt(E.offsetTop)/100:parseInt(E.offsetTop),y=-1!=E.offsetLeft.indexOf("%")?window.innerWidth*parseInt(E.offsetLeft)/100:parseInt(E.offsetLeft);o=k+h<window.innerHeight?E.offsetTop:window.innerHeight-h+"px",e=y+p<window.innerWidth?E.offsetLeft:window.innerWidth-p+"px",v.css("top",o),v.css("left",e)}else if(E.target){v.css("transform","translate(0,0)");var O=E.targetSide||"right",H=$(E.target);if(!H.length)throw new Error("Failed to locate target: "+E.target);var b=H.offset(),T=H.outerWidth(),W=H.outerHeight();"right"==O?e=b.left+T+E.targetOffset+p<window.innerWidth?b.left+T+E.targetOffset:window.innerWidth-p:"left"==O&&(e=b.left-E.targetOffset-p>0?b.left-E.targetOffset-p:0),"top"==E.targetVert?o=b.top:"middle"==E.targetVert?o=b.top-h/2+W/2:"bottom"==E.targetVert&&(o=b.top-h+W),0>o&&(o=0),o+h>window.innerHeight&&(o=window.innerHeight-h),v.css("top",o+"px"),v.css("left",e+"px")}x=$('<div tabindex="-1" class="dk-modal-backdrop"></div>'),E.backdropColor&&x.css("background-color",E.backdropColor),E.click&&x.click(m),E.key&&x.keyup(u),$("body").prepend(x),x.show(),c.addClass(x,"open"),v.show(),v.focus(),c.addClass(v,"open").then(function(){v.trigger("show")})}var v,x,y,O={},M=!1,E=angular.extend({},d,e(h));return O.hide=function(e){M&&(v.find(".exit-ok").off("click",g),v.find(".exit-cancel").off("click",w),v.off("keyup",u)),c.removeClass(x,"open").then(function(){x.remove()}),c.removeClass(v,"open").then(function(){var t="ok"==e?E.okEventName:E.cancelEventName;v.trigger(t),l.$broadcast(t),M?v.hide():v.remove()})},O.init=function(){function t(e,t){this["scope_"+t]=e}if(!E.selector&&!E.template)throw new Error("Must set either dk-modal to selector or data-template to template");if(E.template){if(!E.scope)throw new Error("scope is required with template option");E.scope.$regScope=t;var o;if((o=s.get(E.template))?v=f(o)(E.scope):r.get(E.template).then(function(e){s.put(e.data),v=f(e.data)(E.scope),safeDigest(E.scope)},function(e){throw new Error(e.message)}),!v||0===v.length)throw new Error("Failed to create modal from template: "+E.template)}else if(E.selector&&(M=!0,v=$(E.selector),0===v.length))throw new Error("Failed to find modal from selector: "+E.selector);return angular.extend(E,e(v.data()),e(h)),y={modal:v,scope:E.scope&&E.scope.$modalChild||E.scope}},O.show=function(e){return y||O.init(),E.template?p(function(){k(),e&&e(y)}):(k(),e&&e(y)),y},O}}],r}),t.directive("dkModalTrigger",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$dkModal",function(t,o,n,i){o.click(function(){var r=e(o.data());if(r.template?r.scope=t:n.dkModalTrigger&&/.html$/i.test(n.dkModalTrigger)?(r.template=n.dkModalTrigger,r.scope=t):!r.selector&&n.dkModalTrigger&&(r.selector=n.dkModalTrigger),!r.template&&!r.selector)throw new Error("dkModal: Must supply either a template or selector");"this"==r.target&&(r.target=o),t.$apply(function(){i(r).show()})})}]}})}();